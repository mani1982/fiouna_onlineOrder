<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript 
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script-->
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<style type="text/css">
		/*
 * Base structure
 */

 /* Move down content because we have a fixed navbar that is 50px tall */
 body {
	padding-top: 50px;
}


/*
 * Global add-ons
 */

 .sub-header {
	padding-bottom: 10px;
	border-bottom: 1px solid #eee;
}

/*
 * Top navigation
 * Hide default border to remove 1px line.
 */
 .navbar-fixed-top {
	border: 0;
}

/*
 * Sidebar
 */

 /* Hide for mobile, show later */
/* .sidebar {
	display: none;
}*/
@media (min-width: 768px) {
	.sidebar {
		position: fixed;
		top: 51px;
		bottom: 0;
		left: 0;
		z-index: 1000;
		display: block;
		padding: 20px;
		overflow-x: hidden;
		overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
		background-color: #f5f5f5;
		border-right: 1px solid #eee;
	}
}

/* Sidebar navigation */
.nav-sidebar {
	margin-right: -21px; /* 20px padding + 1px border */
	margin-bottom: 20px;
	margin-left: -20px;
}
.nav-sidebar > li > a {
	padding-right: 20px;
	padding-left: 20px;
}
.nav-sidebar > .active > a,
.nav-sidebar > .active > a:hover,
.nav-sidebar > .active > a:focus {
	color: #fff;
	background-color: #428bca;
}

.checkout_sidebar{
	top: 10px;
	bottom: 0;
	left: 0;
	z-index: 1000;
	display: block;
	padding: 20px;
	overflow-x: hidden;
	overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */

	background-color: #f5f5f5;
	border-left: 1px solid #eee; 
}
/*
 * Main content
 */

 .main {
	padding: 20px;
}
@media (min-width: 768px) {
	.main {
		padding-right: 40px;
		padding-left: 40px;
	}
}
.main .page-header {
	margin-top: 0;
}


/*
 * Placeholder dashboard ideas
 */

 .placeholders {
	margin-bottom: 30px;
	text-align: center;
}
.placeholders h4 {
	margin-bottom: 0;
}
.placeholder {
	margin-bottom: 20px;
}
.placeholder img {
	display: inline-block;
	border-radius: 50%;
}

.shopping-cart-item .shopping-cart-item-remove:hover {
    color: red;
    cursor: pointer;
}
</style>

<!--script src="static/online_order/index.js"></script-->
</head>
<body>
	<!-- Menu items. -->
	<div id="menu-items-details" class="modal fade" tabindex="-1" role="dialog" data-displayed-menu-item-id="" > 

		<div id="menu-items-details-wrapper" class="modal-dialog">
			<form class="form-horizontal addTocart" method="" action="" autocomplete="off" name="addTocart" onsubmit="event.preventDefault();" >
				<div id="menu-items-details-content" class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<div class="modal-title" id="mTitle"></div>                   
					</div>

					<div class="modal-body">



					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Add to Cart</button>
					</div>

				</div>
			</form>   

		</div>

	</div> 
<!--div class="jumbotron">
		<div class="container">
			<h1>Hello, world!</h1>
			<p>This is a template for a simple marketing or informational website. It includes a large callout called a jumbotron and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
			<p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more &raquo;</a></p>
			<ul class="nav nav-pills nav-stacked" id="mani"></ul>
		</div>
	</div-->
	<nav class="navbar navbar-inverse navbar-fixed-top">
	  <div class="container-fluid">
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="#">Project name</a>
	</div>
	<div id="navbar" class="navbar-collapse collapse">
	  <ul class="nav navbar-nav navbar-right">
		<li><a href="#">Dashboard</a></li>
		<li><a href="#">Settings</a></li>
		<li><a href="#">Profile</a></li>
		<li><a href="#">Help</a></li>
	</ul>
	<form class="navbar-form navbar-right">
		<input type="text" class="form-control" placeholder="Search...">
	</form>
</div>
</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-3 col-md-2 sidebar">
			<ul class="nav nav-sidebar" id="mani">

			</ul>

		</div>
		<div class="col-sm-6 col-sm-offset-3 col-md-7 col-md-offset-2 main">
			<h1 class="page-header"></h1>

			<div class="table-responsive" id="section">
				<table id="menutable">

				</table>

			</div>

		</div>

		<div class="col-sm-3 col-md-3 checkout_sidebar">
			<p>check out</p>
			<div id="shopping-cart-content" class="fixed-top">

				<div id="shopping-cart-header">Order Summary</div>

				<div class="shopping-cart-spacer"></div>

				<div class="shopping-cart-sub-header">Order</div>

				<div id="shopping-cart-items" class="">

					<table class="table table-condensed">

						<tbody>
						<!--	<tr id="shopping-cart-item-175438344" class="shopping-cart-item " data-item-id="175438344" data-over-inventory="false">

								<td class="shopping-cart-item-remove" colspan="1">x</td>

								<td class="shopping-cart-item-name" colspan="1">
									<b>Sweet Corn Risotto </b> <br>
									<span class="shopping-cart-item-details"></span> 
								</td>


								<td class="shopping-cart-item-price" colspan="1">
									$13.95	
								</td>

							</tr>   -->

						</tbody>
					</table>

				</div>

				<div id="shopping-cart-totals">

					<table class="table table-condensed">

						<tbody>
				<!--			<tr id="shopping-cart-subtotal-row" class="shopping-cart-total-row">

								<td class="shopping-cart-total-label">Subtotal:</td>
								<td class="shopping-cart-total">$13.95</td>

							</tr>	

							<tr id="shopping-cart-taxtotal-row" class="shopping-cart-total-row">

								<td class="shopping-cart-total-label">Tax:</td>
								<td class="shopping-cart-total">$0.98</td>

							</tr>	

							<tr id="shopping-cart-grandtotal-row" class="shopping-cart-total-row">

								<td id="shopping-cart-grand-total-label" class="shopping-cart-total-label">Total:</td>
								<td id="shopping-cart-grand-total" class="shopping-cart-total">$14.93</td>

							</tr>   -->

						</tbody>
					</table>

				</div>


				<div class="shopping-cart-sub-header">Details</div>

				<div id="shopping-cart-order-details" class="shopping-cart-info-section">


					<!-- Takeout or delivery. -->
					<u>Pickup/Delivery</u>:&nbsp;
					Order is for Pick Up <br>
					<u>Pick up Time</u>:&nbsp;
					
					<!-- ASAP or later. -->
					As Soon As Possible 

					<!-- Delivery fee explanation -->

					<br><div style="text-align: right;"><a href="/trattoria-newbury-boston/menu">(Change)</a></div>

				</div>



				<div id="shopping-cart-bottom-cap"></div>


				<a id="online-order-checkout-button" href="#" class="btn btn-large btn-primary">Checkout</a>


				<p class="gray" style="text-align: center;padding-top:20px;">

				</p>

			</div>
		</div>

	</div>
</div>

</body>
<script>
	$(document).ready(function (){


		// setTimeout(function(){
		// 	console.log('clear');
		// 	window.localStorage.clear();
		// }, 10000);
		var mainobj = {};

		var dish = {};

		//creating menu
		$.get('http://127.0.0.1:8000/online-order/MenusAPIView/').done(function(data){
		//$.get('http://ec2-54-205-29-188.compute-1.amazonaws.com/online-order/MenusAPIView/').done(function(data){
		var d = data;
		//console.log(data)
		for(var i =0; i < d.length; i++){
			$('#mani').append('<li><a href="#" id="'+ d[i].id + '"' + 'value="' + d[i].menus_name  + '" >' + d[i].menus_name + '</a></li>');
		}

		});


		//get the main obj
		$.get('http://127.0.0.1:8000/online-order/FullListdisheshwithDetails/').done(function(data){

			mainobj = data;
		});

		

		setTimeout(function(){
			$('#mani a[id=' + Math.floor((Math.random() * 10) + 1) + ']').trigger("click");
			// $("a").on("click", function(){
			// var that = $(this);
			// console.log(that.text());
			// });

		}	, 500);

		$("#mani").on("click", 'a', function(e){
			e.preventDefault();
			$("#section table").empty();


			var that = $(this);
			//console.log($(that).text());
			var menu_txt = $(that).text();

			$('.page-header').text(menu_txt);

			var dish=[];
			// console.log('az inja: ');
			//     console.log(mainobj);
			$.each(mainobj, function(index, val){
				//console.log(val);
				if(val.menus_name === menu_txt){
					var objectOfthisMenu = this;
					// console.log("menu: ");
					// console.log(val.menus_name);
					 //console.log(this);
					 $.each(objectOfthisMenu.dishes, function(index, val){
						//console.log(val);    
						dish.push({dish_id: val.id, menu_id: val.menus, name: val.dishes_name, description: val.description});
					});

					// console.log("dish object: ");
					// console.log(dish);
				}

			});

			for (var i = 0; i < dish.length; i++) {
				//console.log( dish[i].name);

				$("#section table").append('<tr menu_id="' + dish[i].menu_id + '"  id="' + dish[i].dish_id + '" data-toggle="modal" data-target="#menu-items-details"><td><a href="#"><div class="dishName" value="' + dish[i].name + '"><h4>' + dish[i].name + '</h4></div>' + 
					'<div class="dishDescription">' + dish[i].description + '</div></a></td></tr>');
			}
		});



		$('#menu-items-details').on('show.bs.modal', function (event) {
			var button = $(event.relatedTarget);
			var modal = $(this);
			//console.log(button);
			// console.log(button.attr('menu_id'));
			// console.log(button.attr('id'));
			// console.log(button.find('.dishName h4').text());

			var menuId = button.attr('menu_id');
			var dishId = button.attr('id');
			var dishName = button.find('.dishName h4').text();

			$.each(mainobj, function(index, val){
				//console.log(val);
				if(val.id.toString() === menuId){
					console.log(val);
					$.each(val.dishes, function(i,v){

						if(v.id.toString() === dishId){
							//console.log(v);

							var total = 0.00;
							total += parseFloat(v.sizes[0].price);//.toFixed(2);
							var title = "";
							//var dishName = v.dishes_name
							//console.log(typeof(total));
							title += '<input type="hidden" id="dishname" name="dish_name" value="'+ v.dishes_name +'">';
							title += '<input type="hidden" id="totalprice" name="totalPrice" value="' + total +'">';
							title += '<input type="hidden" id="menu.id" name="menuId" value="' + menuId +'">';
							title += '<input type="hidden" id="dish.id" name="dishId" value="' + dishId +'">';

							title += '<div ><h4>' + v.dishes_name + '</h4></div>';
							title += '<div class="totalamount" name="totalamount" value="'+ total +'" data-base-cost="'+ total +'">';
							title += 'total: $<span class="amount">' + total +'</span></div>';

							title += '<div class="menu-item-details-quantity">';
							title += '<input type="button" class="input-orderitem-quantity-decrement btn" value="-">';
							title += '<input type="text" class="input-orderitem-quantity" size="2" maxlength="2" name="quantity" value="1" readonly="">';
							title += '<input type="button" class="input-orderitem-quantity-increment btn" value="+" onclick="" >';

							modal.find('.modal-title').html(title);

							$('.modal-title').find('.input-orderitem-quantity-increment').on("click",function(event) {
								//console.log("increment");
								updateQuantity(this, 1);
								event.stopPropagation();
							});


							$('.modal-title').find(".input-orderitem-quantity-decrement").bind("click", function(event) {
								//console.log("decrement");
								updateQuantity(this, -1);
								event.stopPropagation();
							});
							var mdl = modal.find('.modal-body').empty();

							var res = '';

							//console.log(v.sizes.length);
							if(v.sizes.length > 1 && v.sizes != undefined){
								res += '<div class="sizeHolder input-group"><h4>Select size: </h4>';
								$.each(v.sizes, function(i,val){
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									//console.log(val);
									res += '<div class="size"><span >';
									res += '<input type="radio" name="size" id="' + val.id + '" value="' +dishName + " " + val.sizes +'" data-price="' + price +'"></span>';
									res += val.sizes + '($'+ price + ')';
									res += '</div>'; 
								});

								//$('input[type=radio]').get(0).checked = true;

							}

							if(v.sides.length > 0 && v.sides != undefined){
								res += '<div class="sideHolder form-group"><h4>Select salad or side: </h4>';
								res += '<select class="sides form-control" name="sides">';
								$.each(v.sides, function(i,val){
									//console.log(val);
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									res += '<option  id="' +val.id +'" value="' +val.side_name +'" data-extra-cost="'+ price +'">';
									res += val.side_name + '</option>';
								});
								res += '</select></div>';

								//$('.modal-body .sideHolder').first().children('.sides').attr('Select', 'selected');
								
							}

							if(v.riceOptions.length > 0 && v.riceOptions != undefined){
								res += '<div class="riceOptionsHolder form-group"><h4>Select rice dish: </h4>';
								res += '<select class="riceOptions form-control" name="riceOptions">';
								$.each(v.riceOptions, function(i,val){
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									res += '<option  id="' +val.id +'" value="' +val.rice_name +'" data-extra-cost="'+ price +'">';
									res += val.rice_name ;
									if(val.price != null){
										res += '(ADD $' + parseFloat(val.price).toFixed(2) +')';        
									}
									res += '</option>';
								});
								res += '</select></div>';
							}
							

							if(v.add.length > 0 && v.add != undefined){
								res += '<div class="addHolder"><h4>Add: </h4>';
								$.each(v.add, function(i,val){
									var price = (val.price)== null? 0 : parseFloat(val.price).toFixed(2);
									res += '<div class="Add">';
									res += '<label><input type="checkbox" name="add" value="' + val.add_name +'" add_id="' + val.id +'" data-extra-cost="'+ price + '" >';
									res += val.add_name + (price > 0 ? '($' + price + ')' : '');
									res += '</label></div>';
								});

								res += '</div>';

							}

							res += '<div class="specialRequests"><textarea class="form-control" rows="2" placeholder="Special instructions, allergies, etc." name="specialRequests"></textarea>';                

							mdl.append(res);

							$('.modal-body input[type=radio]:first').attr('checked', true);

							EvenHandler();
							//updateTotalModalPrice();

							return false;
						}
					});


					return false;
				}

			});

		});

		var EvenHandler = function(){

			$('.modal-body .size').on('change', function(event){
				$('.modal-body').find('.size').each(function() {
					$(this).removeAttr("checked");
				});
				$(this).attr('checked', true);
				updateTotalModalPrice();
			});


			//$('.modal-body .sides option:first').attr('selected','selected');
			
			$('.modal-body .sides').on('change',function(event){
				updateTotalModalPrice();
				// console.log($(this).val());
				// $('option:selected', this).attr('selected','selected');
			});


			$('.modal-body .riceOptions').on('change',function(event){
				updateTotalModalPrice();
				// console.log($(this).val());
				// $('option:selected', this).attr('selected','selected');
			});


			$('.modal-body .Add').on('change', function(event){
				updateTotalModalPrice();
			});

		};

		var updateQuantity = function(el, val){

			//console.log('updateQuantity');
			var currQuantityInput = $('.menu-item-details-quantity').find(".input-orderitem-quantity");

			var currQuantity = parseInt(currQuantityInput.val());
			currQuantity += val;
			if (currQuantity < 1) {
				currQuantity = 1;
			}
			currQuantityInput.val(currQuantity);
			updateTotalModalPrice();
		};


		var updateTotalModalPrice = function(){
			var total = 0, additionalCost = 0, baseCost = 0;
			baseCost = $('.totalamount').data('base-cost'); //.attr('value');
			var quantity = parseInt($('.menu-item-details-quantity').find(".input-orderitem-quantity").val());

			var totalPlaceHolder = $('.totalamount .amount');
			//console.log(totalPlaceHolder);

			var sizeprice = isNaN(parseFloat($('.sizeHolder input[name="size"]:checked').data('price'))) ? 0 : parseFloat($('.sizeHolder input[name="size"]:checked').data('price'));

			if(sizeprice != 0){
				baseCost = sizeprice;
			}

			var sidePrice = isNaN(parseFloat($('.sides option:selected').attr('data-extra-cost'))) ? 0 : parseFloat($('.sides option:selected').attr('data-extra-cost'));

			var ricePrice = isNaN(parseFloat($('.riceOptions option:selected').attr('data-extra-cost'))) ? 0 : parseFloat($('.riceOptions option:selected').attr('data-extra-cost'));

			var addprice = 0;

			// console.log(sizeprice);

			// console.log(sidePrice);

			// console.log(ricePrice);

			$('.Add input[name="add"]').each(function(i, e){
				if(this.checked){
					//console.log($(this).data('extra-cost'));
					addprice += (isNaN(parseFloat($(this).data('extra-cost'))) ? 0 : parseFloat($(this).data('extra-cost')));
				}
			});
			//console.log(addprice);

			//console.log('proce option: ', $('.Add:checkbox'));

			//console.log(quantity);

			total = (baseCost * quantity) + (sidePrice * quantity) + (ricePrice * quantity) + (addprice * quantity);

			totalPlaceHolder.text(total.toFixed(2));
			$('.totalamount').attr('value', total.toFixed(2));
			$('#totalprice').attr('value', total.toFixed(2));
		};


		// a main object for check out process
		var checkout = {};
		checkout.dishes = [];

		function saveCart() {
			//console.log(JSON.stringify(checkout));
			localStorage.setItem("shoppingCart", JSON.stringify(checkout));
		}


		 console.log('main1');
		 console.log(checkout);
		// console.log('main2');
		// console.log(JSON.stringify(checkout));
		// console.log('main3');
		// console.log(JSON.parse(localStorage.getItem("shoppingCart")));


		function loadCart() {
			checkout = JSON.parse(localStorage.getItem("shoppingCart"));
			console.log('main4');
			console.log(checkout);
			if (checkout === null) {
				console.log('yes');
				checkout = {};
				checkout.dishes = [];
				console.log(checkout);
			}
			if(checkout.dishes !== undefined && checkout !== null ){
				console.log('main5');

				console.log(checkout.dishes);
				updateshoppingcart(checkout.dishes);
			}
		}


		setTimeout(function(){
			loadCart();
		}	, 500);

		// setTimeout(function(){
		// 	console.log('clear');
		// 	window.localStorage.clear();
		// }, 200000);




		$('form.addTocart').submit(function(e){
			//console.log($(this).serializeArray());
			var addtocheckout = $(this).serializeArray();
			//console.log(addtocheckout);
			//console.log(JSON.stringify($(this).serializeArray()));
			var dish= {};
			var adds = [];
			$(addtocheckout).each(function(index, obj){

				if(obj.name == "add"){
					adds.push(obj.value);
				}

				dish['add'] = adds;
				dish[obj.name] = obj.value;
			});
			console.log(checkout);
			checkout.dishes.push(dish);
			updateshoppingcart(checkout.dishes);
			$('.modal').modal('toggle');
		});

		



		var updateshoppingcart = function(addeddish){
			
			
			$('#shopping-cart-items tbody').empty();
			$('#shopping-cart-totals tbody').empty();

			//$('.table table-condensed tbody').empty();


			var item_row = '',total_row ='', subtotal = 0, total = 0, tax = 0, taxrates = 0;

			//console.log(checkout);

			$.each(checkout.dishes, function(index, dish){
				//console.log(index, dish);

				item_row += '<tr class="shopping-cart-item" id="' + index +'">';
				item_row += '<td class="shopping-cart-item-remove" colspan="1">x</td>';
				item_row += '<td class="shopping-cart-dish_name" colspan="1">';
				if(dish.size){
					item_row += '<b>' + dish.size + (parseInt(dish.quantity) > 1 ? ' X ' + dish.quantity : '') +'</b><br>';
				}
				else{
					item_row += '<b>' + dish.dish_name + (parseInt(dish.quantity) > 1 ? ' X ' + dish.quantity : '') + '</b><br>';
				}

				var spanElements =[];
				if(dish.add.length > 0){
					spanElements = spanElements.concat(dish.add);
				}
				if(dish.sides){
					spanElements.push(dish.sides); 
				}
				if(dish.riceOptions){
					spanElements.push(dish.riceOptions);
				}
				if(spanElements.length > 0){
					item_row += '<span class="shopping-cart-item-details">';

					item_row += spanElements.join(", ") + '</span><br>';
				}
				if(dish.specialRequests){
					item_row += '<span class="shopping-cart-item-details">' + dish.specialRequests + '</span> </td>';	
				}
				
				item_row += '<td class="shopping-cart-item-price" colspan="1">' + dish.totalPrice + '<t>';
				item_row += '</tr>';

				subtotal += parseFloat(dish.totalPrice);

			});

			var taxurl = 'https://taxrates.api.avalara.com/postal?country=usa&postal=02215&apikey=mWHZkdof4fEYM9gAXhLtaOUnplWIsqQUNHY52Mb8tamVkBSrXTojxDnTML3P2PYtQ9XuIgNOyPeet8bkaJQEBA%3D%3D'; 

				//console.log(subtotal.toFixed(2));
				checkout.subtotal = subtotal;

				$.get(taxurl).done(function(data){
					//console.log(data);
					taxrates = parseFloat(data.totalRate);
					//console.log(taxrates);

					// console.log(subtotal);
					// console.log(taxrates);
					tax = (subtotal * taxrates) / 100;
					total = subtotal + tax;
					//console.log(tax);

					total_row += '<tr id="shopping-cart-subtotal-row" class="shopping-cart-total-row">';
					total_row += '<td class="shopping-cart-total-label">Subtotal:</td>';
					total_row += '<td class="shopping-cart-total">' + subtotal.toFixed(2) +'</td></tr>';

					total_row += '<tr id="shopping-cart-taxtotal-row" class="shopping-cart-total-row">';
					total_row += '<td class="shopping-cart-total-label">Tax:</td>';
					total_row += '<td class="shopping-cart-total">' + tax.toFixed(2) +'</td></tr>';

					total_row += '<tr id="shopping-cart-grandtotal-row" class="shopping-cart-total-row">';
					total_row += '<td id="shopping-cart-grand-total-label" class="shopping-cart-total-label">Total:</td>';
					total_row += '<td id="shopping-cart-grand-total" class="shopping-cart-total">' + total.toFixed(2) +'</td></tr>';

					checkout.total = total;


					$('#shopping-cart-totals tbody').append(total_row);
				});


			$('#shopping-cart-items tbody').append(item_row);
			
			setShoppingCartEventHandlers();
			saveCart();
		};


		var setShoppingCartEventHandlers = function() {
			
			//console.log('before');
			//console.log(checkout.dishes);

			// Event handler: Remove shopping cart item.
			$(".shopping-cart-item-remove").one("click", function(event) {
				console.log($(this).parent().attr('id'));

				var obj_id = $(this).parent().attr('id');
                // Prevent x from being clicked twice causing an error.
                $(this).on("click", function(event) {
                	event.preventDefault();
                });


                checkout.dishes.splice(obj_id, 1);

                console.log('after');
                console.log(checkout.dishes);
                updateshoppingcart(checkout.dishes);
                
                event.stopPropagation();
            });		
		}

		// setTimeout(function(){
		// 	console.log(checkout);
		// }	, 500);





	});
</script>
</html>
