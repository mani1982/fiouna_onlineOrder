<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Fiouna online order</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"  rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="login_modal/login.css">
	<link rel="stylesheet" href="css/style.css">

	<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>


	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


	<!--script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/121761/card.js'></script>
	<script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/121761/jquery.card.js'></script-->

	<!-- Load the required client component. -->
	<script src="https://js.braintreegateway.com/web/3.2.0/js/client.min.js"></script>
	<script src="https://js.braintreegateway.com/web/3.2.0/js/paypal.min.js"></script>
	<script src="https://js.braintreegateway.com/web/3.2.0/js/hosted-fields.min.js"></script>
	<script src="https://js.braintreegateway.com/web/3.2.0/js/data-collector.min.js"></script>

	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBX5_8mDxj0Gs9Dzb6lgyaJYjUwvvyEtgk"></script>



	<style type="text/css">
			/*
	 * Base structure
	 */

	 /* Move down content because we have a fixed navbar that is 50px tall */
	 body {
	 	padding-top: 50px;
	 }


	/*
	 * Global add-ons
	 */

	 .sub-header {
	 	padding-bottom: 10px;
	 	border-bottom: 1px solid #eee;
	 }

	/*
	 * Top navigation
	 * Hide default border to remove 1px line.
	 */
	 .navbar-fixed-top {
	 	border: 0;
	 }

	/*
	 * Sidebar
	 */

	 /* Hide for mobile, show later */
	/* .sidebar {
		display: none;
	}*/
	@media (min-width: 768px) {
		.sidebar {
			position: fixed;
			top: 51px;
			bottom: 0;
			left: 0;
			z-index: 1000;
			display: block;
			padding: 20px;
			overflow-x: hidden;
			overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
			background-color: #f5f5f5;
			border-right: 1px solid #eee;
		}
	}

	/* Sidebar navigation */
	.nav-sidebar {
		margin-right: -21px; /* 20px padding + 1px border */
		margin-bottom: 20px;
		margin-left: -20px;
	}
	.nav-sidebar > li > a {
		padding-right: 20px;
		padding-left: 20px;
	}
	.nav-sidebar > .active > a,
	.nav-sidebar > .active > a:hover,
	.nav-sidebar > .active > a:focus {
		color: #fff;
		background-color: #428bca;
	}

	.checkout_sidebar{
		top: 10px;
		bottom: 0;
		left: 0;
		z-index: 1000;
		display: block;
		padding: 20px;
		overflow-x: hidden;
		overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */

		background-color: #f5f5f5;
		border-left: 1px solid #eee; 
	}
	/*
	 * Main content
	 */

	 .main {
	 	padding: 20px;
	 }
	 @media (min-width: 768px) {
	 	.main {
	 		padding-right: 40px;
	 		padding-left: 40px;
	 	}
	 }
	 .main .page-header {
	 	margin-top: 0;
	 }


	/*
	 * Placeholder dashboard ideas
	 */

	 .placeholders {
	 	margin-bottom: 30px;
	 	text-align: center;
	 }
	 .placeholders h4 {
	 	margin-bottom: 0;
	 }
	 .placeholder {
	 	margin-bottom: 20px;
	 }
	 .placeholder img {
	 	display: inline-block;
	 	border-radius: 50%;
	 }

	 .shopping-cart-item .shopping-cart-item-remove:hover {
	 	color: red;
	 	cursor: pointer;
	 }

	 /* modal styles */
	 form .modal-title h4 {
	 	font-size: 20px;
	 	color: #23527c;
	 	padding-bottom: 4px;
	 	border-bottom: 1px solid #98b6d2;
	 }

	 form input.input-spinner {
	 	height: 2em;
	 	margin: -2px 2px 0 2px;
	 	padding: 3px 12px;
	 }

	 form input.input-orderitem-quantity {
	 	padding: 2px 4px;
	 	text-align: center;
	 }

	 form .size span {
	 	margin: 2px 6px;
	 	padding-right: 4px;
	 }

	 form input[type="checkbox"] {margin: 2px 6px;}

	 form textarea {margin-top: 12px;}

	 form .btn {padding: 12px 24px;}

	 input#next{
	 	float: right;
	 	height: 40px;
	 	width: 80px;
	 	margin: 15px;
	 	padding: 0px;
	 	text-align: -webkit-center;
	 	border-radius: 6px;
	 }

	 input#pre{
	 	float: left;
	 	height: 40px;
	 	width: 80px;
	 	margin: 15px;
	 	padding: 0px;
	 	text-align: -webkit-center;
	 	border-radius: 6px;
	 }
	</style>


	<style>
		.form-group {
				width: 100%;
			}
		.panel {
			/*width: 80%;*/
			margin: 2em auto;
		}

		.bootstrap-basic {
			background: white;
		}

/*		.panel-body {
			width: 90%;
			margin: 2em auto;
		}*/

		.helper-text {
			color: #8A6D3B;
			font-size: 12px;
			margin-top: 5px;
			height: 12px;
			display: block;
		}

		/* Braintree Hosted Fields styling classes*/
		.braintree-hosted-fields-focused { 
			border: 1px solid #0275d8;
			box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
		}

		.braintree-hosted-fields-focused.focused-invalid {
			border: 1px solid #ebcccc;
			box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(100,100,0,.6);
		}

		@media (max-width: 100px) {
			.form-group {
				width: 100%;
			}

			.btn {
				white-space: normal;
			}
		}

	</style>

	<!--script src="static/online_order/index.js"></script-->
</head>
<body>
	<!-- Menu items. -->
	<div id="menu-items-details" class="modal fade" tabindex="-1" role="dialog" data-displayed-menu-item-id="" > 
		<div id="menu-items-details-wrapper" class="modal-dialog">
			<form class="form-horizontal addTocart" method="" action="" autocomplete="off" name="addTocart" onsubmit="event.preventDefault();" >
				<div id="menu-items-details-content" class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<div class="modal-title" id="mTitle"></div>                   
					</div>
					<div class="modal-body">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Add to Cart</button>
					</div>
				</div>
			</form>   
		</div>
	</div>



	<div id="signin-signup" class="modal fade" tabindex="-1" role="dialog" >
		<div class="container">
			<div class="row">
				<div class="col-md-4"></div>
				<div class="col-md-4">
					<div class="flip">
						<div class="card"> 
							<div class="face front"> 
								<div class="panel panel-default">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									</div>
									<form id="signin-form" class="form-horizontal">
										<br>
										<h2 class="text-center">Please sign in</h2>
										<br>
										<input class="form-control" type="email" name="email" placeholder="Email" required="true" />
										<input class="form-control" type="password" name="password" placeholder="Password" required="true" />
										<p class="text-right"><a href="">Forgot Password</a></p>
										<button id="log-in" class="btn btn-primary btn-block">LOG IN</button>
										<p class="text-center">
											<a href="#" class="fliper-btn">Create new account?</a>
										</p>
									</form>
								</div>
							</div> 
							<div class="face back"> 
								<div class="panel panel-default">
									<form id="signup-form" class="form-horizontal">
										<br>
										<h2 class="text-center">Please sign up</h2>
										<br>
										<label>Basic Information</label>
										<input class="form-control" name="first_name" placeholder="First name" required="true" />
										<input class="form-control" name="last_name" placeholder="Last name" required="true"/>
										<input class="form-control" type="email" name="email" placeholder="Email" required="true"/>
										<input class="form-control" type="email" name="email2" placeholder="Confirm Email" required="true"/>
										<label>Private Information</label>
										<input class="form-control" type="password" name="password" placeholder="Password" required="true"/>
										<input class="form-control" type="password" name="retryPassword" placeholder="re-try Password" required="true"/>
										<!--input class="form-control" name="MobileNumber" placeholder="Mobile Number"/ -->
										<button class="btn btn-primary btn-block">SIGN UP</button>
										<p class="text-center">
											<a href="#" class="fliper-btn">Already have an account?</a>
										</p>
									</form>
								</div>
							</div>
						</div>   
					</div>
				</div>
				<!--div class="col-md-4"></div -->
			</div>
		</div><!-- /.container -->		
	</div>

	<div id="checkout-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="checkout-modalLabel" data-backdrop="true" data-keyboard="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content" id="checkout-modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<!-- <h4 class="modal-title" id="myModalLabel">Modal title</h4> -->
					

					<div class="personal-information">
						<h1>Payment Information</h1>
					</div> <!-- end of personal-information -->
				</div>
				<div class="modal-body">
					<form id="checkout-modal-form">
						<div id="1">
							<input id="first-name" class="column-left" type="text" required="required" name="firstname" placeholder="First Name"/>

							<input id="last-name" class="column-right" type="text" name="lastname" placeholder="last-name" required="required"/>

							<input id="email" class="input-field" type="email" name="email" required="required" autocomplete="on" maxlength="40" placeholder="Email"/>
						</div>

						<div id="2" style="display:none">
							<div id="delivery_option">
								<select id="delivery_option_selection">
									<option id="pickup" name="pickup" value="pickup">
										pickup
									</option>

									<option id="delivery" name="delivery" value="delivery">
										delivery
									</option>
								</select>
							</div>

							<div id="address" style="display:none">

							</div>
						</div>
					</form>

					<div id="3" style="display:none">

						<div id="payment_option">
							<select id="payment_option_selection">
								<option id="cash" name="cash" value="Cash">
									Cash
								</option>

								<option id="creditcard" name="creditcard" value="creditcard">
									creditcard
								</option>
							</select>
						</div>

						<div id="payment" style="display:none">
							<div class="panel panel-default bootstrap-basic"> 
								<form class="panel-body"> 
									<div class="row"> 
										<div class="form-group col-xs-8"> 
											<label class="control-label">Card Number</label> 
											<div class="form-control" id="card-number"></div> 
											<span class="helper-text"></span> 
										</div>
										<div class="form-group col-xs-4"> 
											<div class="row"> 
												<label class="control-label col-xs-12">Expiration Date</label> 
												<div class="col-xs-6"> 
													<div class="form-control" id="expiration-month"></div> 
												</div>
												<div class="col-xs-6"> 
													<div class="form-control" id="expiration-year"></div> 
												</div> 
											</div> 
										</div> 
									</div>
									<div class="row"> 
										<div class="form-group col-xs-6"> 
											<label class="control-label">Security Code</label>
											<div class="form-control" id="cvv"></div> 
										</div>
										<div class="form-group col-xs-6"> 
											<label class="control-label">Zipcode</label>
											<div class="form-control" id="postal-code"></div>
										</div>
									</div>
								</form>
							</div>

						</div>

						<input id="final-checkout" class="input-button" type="submit" value="Submit" />
					</div>
					
				</div>
				<div class="modal-footer">
					<input id="pre" class="btn btn-primary" type="button" value="previous" style="display:none" />
					<input id="next" class="btn btn-primary" type="button" value="next" page-id="1"/>
				</div>



			</div>
		</div>
	</div>

	<nav class="navbar navbar-inverse navbar-fixed-top">
	  	<div class="container-fluid">
			<div class="navbar-header">
			  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">Fiouna Online Order</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
			  	<ul class="nav navbar-nav navbar-right">
					<li id="login" data-toggle = "modal" data-target="#signin-signup"><a href="#">Login/register</a></li>
					<li id="user-logedin" class="dropdown" style="display: none;">
						<a id="userLoginName" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" id="menu1" aria-labelledby="drop4"> 
							<li><a id="pastOrder" href="#">Past Order</a></li> 
							<li><a href="#">Another action</a></li> 
							<li><a href="#">Something else here</a></li> 
							<li role="separator" class="divider"></li> 
							<li><a id="logout" href="#">Logout</a></li> 
						</ul>

					</li>

				</ul>
			</div>
		</div>
	</nav>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-3 col-md-2 sidebar">
			<ul class="nav nav-sidebar" id="mani">

			</ul>

		</div>
		<div class="col-sm-6 col-sm-offset-3 col-md-7 col-md-offset-2 main">
			<h1 class="page-header"></h1>

			<div class="table-responsive" id="section">
				<table id="menutable">

				</table>

			</div>

		</div>

		<div class="col-sm-3 col-md-3 checkout_sidebar">
			<p>check out</p>
			<div id="shopping-cart-content" class="fixed-top">

				<div id="shopping-cart-header">Order Summary</div>

				<div class="shopping-cart-spacer"></div>

				<div class="shopping-cart-sub-header">Order</div>

				<div id="shopping-cart-items" class="">

					<table class="table table-condensed">

						<tbody>
						<!--	<tr id="shopping-cart-item-175438344" class="shopping-cart-item " data-item-id="175438344" data-over-inventory="false">

								<td class="shopping-cart-item-remove" colspan="1">x</td>

								<td class="shopping-cart-item-name" colspan="1">
									<b>Sweet Corn Risotto </b> <br>
									<span class="shopping-cart-item-details"></span> 
								</td>


								<td class="shopping-cart-item-price" colspan="1">
									$13.95	
								</td>

							</tr>   -->

						</tbody>
					</table>

				</div>

				<div id="shopping-cart-totals">

					<table class="table table-condensed">

						<tbody>

						</tbody>
					</table>

				</div>


				<div class="shopping-cart-sub-header">Details</div>

				<div id="shopping-cart-order-details" class="shopping-cart-info-section">


					<!-- Takeout or delivery. -->
					<u>Pickup/Delivery</u>:&nbsp;
					Order is for Pick Up <br>
					<u>Pick up Time</u>:&nbsp;
					
					<!-- ASAP or later. -->
					As Soon As Possible 

					<!-- Delivery fee explanation -->

					<br><div style="text-align: right;"><a href="#">(Change)</a></div>

				</div>



				<div id="shopping-cart-bottom-cap">


				<a id="online-order-checkout-button" href="#" class="btn btn-large btn-primary" data-toggle="modal"
				data-target="#checkout-modal">Checkout</a>
				</div>

			</div>
		</div>

	</div>
</div>

</body>

<script type="text/javascript" src="login_modal/login.js"></script>
<script>
	$(document).ready(function (){


		// setTimeout(function(){
		// 	console.log('clear');
		// 	window.localStorage.clear();
		// }, 10000);
		var mainobj = {};

		var dish = {};

		//creating menu
		$.get('http://127.0.0.1:8000/online-order/MenusAPIView/').done(function(data){
		//$.get('http://ec2-54-205-29-188.compute-1.amazonaws.com/online-order/MenusAPIView/').done(function(data){
		var d = data;
		//console.log(data)on
		for(var i =0; i < d.length; i++){
			$('#mani').append('<li><a href="#" id="'+ d[i].id + '"' + 'value="' + d[i].menus_name  + '" >' + d[i].menus_name + '</a></li>');
		}

		});


		//get the main obj
		$.get('http://127.0.0.1:8000/online-order/FullListdisheshwithDetails/').done(function(data){

			mainobj = data;
		});

		

		setTimeout(function(){
			$('#mani a[id=' + Math.floor((Math.random() * 10) + 1) + ']').trigger("click");
			// $("a").on("click", function(){
			// var that = $(this);
			// console.log(that.text());
			// });

		}	, 700);

		$("#mani").on("click", 'a', function(e){
			e.preventDefault();
			$("#section table").empty();


			var that = $(this);
			//console.log($(that).text());
			var menu_txt = $(that).text();

			$('.page-header').text(menu_txt);

			var dish=[];
			// console.log('az inja: ');
			//     console.log(mainobj);
			$.each(mainobj, function(index, val){
				//console.log(val);
				if(val.menus_name === menu_txt){
					var objectOfthisMenu = this;
					// console.log("menu: ");
					// console.log(val.menus_name);
					 //console.log(this);
					 $.each(objectOfthisMenu.dishes, function(index, val){
						//console.log(val);    
						dish.push({dish_id: val.id, menu_id: val.menus, name: val.dishes_name, description: val.description});
					});

					// console.log("dish object: ");
					// console.log(dish);
				}

			});

			for (var i = 0; i < dish.length; i++) {
				//console.log( dish[i].name);

				$("#section table").append('<tr menu_id="' + dish[i].menu_id + '"  id="' + dish[i].dish_id + '" data-toggle="modal" data-target="#menu-items-details"><td><a href="#"><div class="dishName" value="' + dish[i].name + '"><h4>' + dish[i].name + '</h4></div>' + 
					'<div class="dishDescription">' + dish[i].description + '</div></a></td></tr>');
			}
		});

		$("#login").on("click", function(event){
			$('#signin-signup').on('shown.bs.modal', function (event) {
				$('#signin-signup').focus()
			})
		});

		$('#menu-items-details').on('show.bs.modal', function (event) {
			var button = $(event.relatedTarget);
			var modal = $(this);
			//console.log(button);
			// console.log(button.attr('menu_id'));
			// console.log(button.attr('id'));
			// console.log(button.find('.dishName h4').text());

			var menuId = button.attr('menu_id');
			var dishId = button.attr('id');
			var dishName = button.find('.dishName h4').text();

			$.each(mainobj, function(index, val){
				//console.log(val);
				if(val.id.toString() === menuId){
					console.log(val);
					$.each(val.dishes, function(i,v){

						if(v.id.toString() === dishId){
							//console.log(v);

							var total = 0.00;
							total += parseFloat(v.sizes[0].price);//.toFixed(2);
							var title = "";
							//var dishName = v.dishes_name
							//console.log(typeof(total));
							title += '<input type="hidden" id="dishname" name="dish_name" value="'+ v.dishes_name +'">';
							title += '<input type="hidden" id="totalprice" name="totalPrice" value="' + total +'">';
							title += '<input type="hidden" id="menu.id" name="menuId" value="' + menuId +'">';
							title += '<input type="hidden" id="dish.id" name="dishId" value="' + dishId +'">';

							title += '<div ><h4>' + v.dishes_name + '</h4></div>';
							title += '<div class="totalamount" name="totalamount" value="'+ total +'" data-base-cost="'+ total +'">';
							title += 'total: $<span class="amount">' + total +'</span></div>';

							title += '<div class="menu-item-details-quantity">';
							title += '<input type="button" class="input-spinner input-orderitem-quantity-decrement btn" value="-">';
							title += '<input type="text" class="input-orderitem-quantity" size="2" maxlength="2" name="quantity" value="1" readonly="">';
							title += '<input type="button" class="input-spinner input-orderitem-quantity-increment btn" value="+" onclick="" >';

							modal.find('.modal-title').html(title);

							$('.modal-title').find('.input-orderitem-quantity-increment').on("click",function(event) {
								//console.log("increment");
								updateQuantity(this, 1);
								event.stopPropagation();
							});


							$('.modal-title').find(".input-orderitem-quantity-decrement").bind("click", function(event) {
								//console.log("decrement");
								updateQuantity(this, -1);
								event.stopPropagation();
							});
							var mdl = modal.find('.modal-body').empty();

							var res = '';

							//console.log(v.sizes.length);
							if(v.sizes.length > 1 && v.sizes != undefined){
								res += '<div class="sizeHolder input-group"><h4>Select size: </h4>';
								$.each(v.sizes, function(i,val){
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									//console.log(val);
									res += '<div class="size"><span >';
									res += '<input type="radio" name="size" id="' + val.id + '" value="' +dishName + " " + val.sizes +'" data-price="' + price +'"></span>';
									res += val.sizes + '($'+ price + ')';
									res += '</div>'; 
								});
								res += '</div>';

								//$('input[type=radio]').get(0).checked = true;

							}

							if(v.sides.length > 0 && v.sides != undefined){
								res += '<div class="sideHolder form-group"><h4>Select salad or side: </h4>';
								res += '<select class="sides form-control" name="sides">';
								$.each(v.sides, function(i,val){
									//console.log(val);
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									res += '<option  id="' +val.id +'" value="' +val.side_name +'" data-extra-cost="'+ price +'">';
									res += val.side_name + '</option>';
								});
								res += '</select></div>';

								//$('.modal-body .sideHolder').first().children('.sides').attr('Select', 'selected');
								
							}

							if(v.riceOptions.length > 0 && v.riceOptions != undefined){
								res += '<div class="riceOptionsHolder form-group"><h4>Select rice dish: </h4>';
								res += '<select class="riceOptions form-control" name="riceOptions">';
								$.each(v.riceOptions, function(i,val){
									var price = (val.price)== null? 0 :  parseFloat(val.price).toFixed(2);
									res += '<option  id="' +val.id +'" value="' +val.rice_name +'" data-extra-cost="'+ price +'">';
									res += val.rice_name ;
									if(val.price != null){
										res += '(ADD $' + parseFloat(val.price).toFixed(2) +')';        
									}
									res += '</option>';
								});
								res += '</select></div>';
							}
							

							if(v.add.length > 0 && v.add != undefined){
								res += '<div class="addHolder"><h4>Add: </h4>';
								$.each(v.add, function(i,val){
									var price = (val.price)== null? 0 : parseFloat(val.price).toFixed(2);
									res += '<div class="Add">';
									res += '<label><input type="checkbox" name="add" value="' + val.add_name +'" add_id="' + val.id +'" data-extra-cost="'+ price + '" >';
									res += val.add_name + (price > 0 ? '($' + price + ')' : '');
									res += '</label></div>';
								});

								res += '</div>';

							}

							res += '<div class="specialRequests"><textarea class="form-control" rows="2" placeholder="Special instructions, allergies, etc." name="specialRequests"></textarea>';                

							mdl.append(res);

							$('.modal-body input[type=radio]:first').attr('checked', true);

							EventHandler();
							//updateTotalModalPrice();

							return false;
						}
					});


					return false;
				}

			});

		});

		var EventHandler = function(){

			$('.modal-body .size').on('change', function(event){
				$('.modal-body').find('.size').each(function() {
					$(this).removeAttr("checked");
				});
				$(this).attr('checked', true);
				updateTotalModalPrice();
			});


			//$('.modal-body .sides option:first').attr('selected','selected');
			
			$('.modal-body .sides').on('change',function(event){
				updateTotalModalPrice();
				// console.log($(this).val());
				// $('option:selected', this).attr('selected','selected');
			});


			$('.modal-body .riceOptions').on('change',function(event){
				updateTotalModalPrice();
				// console.log($(this).val());
				// $('option:selected', this).attr('selected','selected');
			});


			$('.modal-body .Add').on('change', function(event){
				updateTotalModalPrice();
			});

		};

		var updateQuantity = function(el, val){

			//console.log('updateQuantity');
			var currQuantityInput = $('.menu-item-details-quantity').find(".input-orderitem-quantity");

			var currQuantity = parseInt(currQuantityInput.val());
			currQuantity += val;
			if (currQuantity < 1) {
				currQuantity = 1;
			}
			currQuantityInput.val(currQuantity);
			updateTotalModalPrice();
		};


		var updateTotalModalPrice = function(){
			var total = 0, additionalCost = 0, baseCost = 0;
			baseCost = $('.totalamount').data('base-cost'); //.attr('value');
			var quantity = parseInt($('.menu-item-details-quantity').find(".input-orderitem-quantity").val());

			var totalPlaceHolder = $('.totalamount .amount');
			//console.log(totalPlaceHolder);

			var sizeprice = isNaN(parseFloat($('.sizeHolder input[name="size"]:checked').data('price'))) ? 0 : parseFloat($('.sizeHolder input[name="size"]:checked').data('price'));

			if(sizeprice != 0){
				baseCost = sizeprice;
			}

			var sidePrice = isNaN(parseFloat($('.sides option:selected').attr('data-extra-cost'))) ? 0 : parseFloat($('.sides option:selected').attr('data-extra-cost'));

			var ricePrice = isNaN(parseFloat($('.riceOptions option:selected').attr('data-extra-cost'))) ? 0 : parseFloat($('.riceOptions option:selected').attr('data-extra-cost'));

			var addprice = 0;

			// console.log(sizeprice);

			// console.log(sidePrice);

			// console.log(ricePrice);

			$('.Add input[name="add"]').each(function(i, e){
				if(this.checked){
					//console.log($(this).data('extra-cost'));
					addprice += (isNaN(parseFloat($(this).data('extra-cost'))) ? 0 : parseFloat($(this).data('extra-cost')));
				}
			});
			//console.log(addprice);

			//console.log('proce option: ', $('.Add:checkbox'));

			//console.log(quantity);

			total = (baseCost * quantity) + (sidePrice * quantity) + (ricePrice * quantity) + (addprice * quantity);

			totalPlaceHolder.text(total.toFixed(2));
			$('.totalamount').attr('value', total.toFixed(2));
			$('#totalprice').attr('value', total.toFixed(2));
		};


		// a main object for check out process
		var checkout = {};
		checkout.dishes = [];
		checkout.user = {};
		checkout.delivery = 0;
		checkout.final= {};

		function saveCart() {
			//console.log(JSON.stringify(checkout));
			localStorage.setItem("shoppingCart", JSON.stringify(checkout));
		}


		 console.log('main1');
		 console.log(checkout);
		// console.log('main2');
		// console.log(JSON.stringify(checkout));
		// console.log('main3');
		// console.log(JSON.parse(localStorage.getItem("shoppingCart")));


		function loadCart() {
			checkout = JSON.parse(localStorage.getItem("shoppingCart"));
			console.log('main4');
			console.log(checkout);
			if (checkout === null) {
				console.log('yes');
				checkout = {};
				checkout.dishes = [];
				checkout.user = {};
				checkout.final= {};
				console.log(checkout);
			}
			if(checkout.dishes !== undefined && checkout !== null){
				console.log('main5');

				console.log(checkout);
				updateshoppingcart();
			}
		}


		setTimeout(function(){
			loadCart();
		}	, 500);

		// setTimeout(function(){
		// 	console.log('clear');
		// 	window.localStorage.clear();
		// }, 200);

		var deletedata = function(){
			window.localStorage.clear();
		}




		$('form.addTocart').submit(function(e){
			//console.log($(this).serializeArray());
			var addtocheckout = $(this).serializeArray();
			//console.log(addtocheckout);
			//console.log(JSON.stringify($(this).serializeArray()));
			var dish= {};
			var adds = [];
			$(addtocheckout).each(function(index, obj){

				if(obj.name == "add"){
					adds.push(obj.value);
				}

				dish['add'] = adds;
				dish[obj.name] = obj.value;
			});
			console.log(checkout);
			checkout.dishes.push(dish);
			updateshoppingcart();
			$('#menu-items-details').modal('toggle');
		});

		



		var updateshoppingcart = function(){
			
			
			$('#shopping-cart-items tbody').empty();
			$('#shopping-cart-totals tbody').empty();

			//$('.table table-condensed tbody').empty();


			var item_row = '',total_row ='', subtotal = 0, total = 0, tax = 0, taxrates = 7, delivery = 0.00;

			//console.log(checkout);

			$.each(checkout.dishes, function(index, dish){
				//console.log(index, dish);

				item_row += '<tr class="shopping-cart-item" id="' + index +'">';
				item_row += '<td class="shopping-cart-item-remove" colspan="1">x</td>';
				item_row += '<td class="shopping-cart-dish_name" colspan="1">';
				if(dish.size){
					item_row += '<b>' + dish.size + (parseInt(dish.quantity) > 1 ? ' X ' + dish.quantity : '') +'</b><br>';
				}
				else{
					item_row += '<b>' + dish.dish_name + (parseInt(dish.quantity) > 1 ? ' X ' + dish.quantity : '') + '</b><br>';
				}

				var spanElements =[];
				if(dish.add.length > 0){
					spanElements = spanElements.concat(dish.add);
				}
				if(dish.sides){
					spanElements.push(dish.sides); 
				}
				if(dish.riceOptions){
					spanElements.push(dish.riceOptions);
				}
				if(spanElements.length > 0){
					item_row += '<span class="shopping-cart-item-details">';

					item_row += spanElements.join(", ") + '</span><br>';
				}
				if(dish.specialRequests){
					item_row += '<span class="shopping-cart-item-details">' + dish.specialRequests + '</span> </td>';	
				}
				
				item_row += '<td class="shopping-cart-item-price" colspan="1">' + dish.totalPrice + '<t>';
				item_row += '</tr>';

				subtotal += parseFloat(dish.totalPrice);

			});

			//var taxurl ='https://taxrates.api.avalara.com/postal?country=usa&postal=02215&apikey=mWHZkdof4fEYM9gAXhLtaOUnplWIsqQUNHY52Mb8tamVkBSrXTojxDnTML3P2PYtQ9XuIgNOyPeet8bkaJQEBA%3D%3D'; 

				//console.log(subtotal.toFixed(2));
				checkout.subtotal = subtotal;

				if(checkout.delivery == undefined){
					checkout.delivery=0.00;
				}
				delivery = parseFloat(checkout.delivery);
				console.log(checkout.delivery);

				// $.get(taxurl).done(function(data){
				// 	console.log(data);
				// 	taxrates = parseFloat(data.totalRate);
				// 	console.log(taxrates);

				// 	// console.log(subtotal);
				// 	// console.log(taxrates);
				// 	tax = (subtotal * taxrates) / 100;
				// 	total = subtotal + tax;
				// 	//console.log(tax);

				// 	total_row += '<tr id="shopping-cart-subtotal-row" class="shopping-cart-total-row">';
				// 	total_row += '<td class="shopping-cart-total-label">Subtotal:</td>';
				// 	total_row += '<td class="shopping-cart-total">' + subtotal.toFixed(2) +'</td></tr>';

				// 	total_row += '<tr id="shopping-cart-taxtotal-row" class="shopping-cart-total-row">';
				// 	total_row += '<td class="shopping-cart-total-label">Tax:</td>';
				// 	total_row += '<td class="shopping-cart-total">' + tax.toFixed(2) +'</td></tr>';

				// 	total_row += '<tr id="shopping-cart-grandtotal-row" class="shopping-cart-total-row">';
				// 	total_row += '<td id="shopping-cart-grand-total-label" class="shopping-cart-total-label">Total:</td>';
				// 	total_row += '<td id="shopping-cart-grand-total" class="shopping-cart-total">' + total.toFixed(2) +'</td></tr>';

				// 	checkout.total = total;


				// 	$('#shopping-cart-totals tbody').append(total_row);
				// });

				tax = (subtotal * taxrates) / 100;
				total = subtotal + tax + delivery;

				total_row += '<tr id="shopping-cart-subtotal-row" class="shopping-cart-total-row">';
				total_row += '<td class="shopping-cart-total-label">Subtotal:</td>';
				total_row += '<td class="shopping-cart-total">' + subtotal.toFixed(2) +'</td></tr>';

				total_row += '<tr id="shopping-cart-taxtotal-row" class="shopping-cart-total-row">';
				total_row += '<td class="shopping-cart-total-label">Tax:</td>';
				total_row += '<td class="shopping-cart-total">' + tax.toFixed(2) +'</td></tr>';

				total_row += '<tr id="shopping-cart-delivery-row" class="shopping-cart-total-row">';
				total_row += '<td class="shopping-cart-total-label">delivery:</td>';
				total_row += '<td class="shopping-cart-total" id="delivery">' + delivery.toFixed(2) +'</td></tr>';

				total_row += '<tr id="shopping-cart-grandtotal-row" class="shopping-cart-total-row">';
				total_row += '<td id="shopping-cart-grand-total-label" class="shopping-cart-total-label">Total:</td>';
				total_row += '<td id="shopping-cart-grand-total" class="shopping-cart-total">' + total.toFixed(2) +'</td></tr>';

				checkout.total = total;


				$('#shopping-cart-totals tbody').append(total_row);


				$('#shopping-cart-items tbody').append(item_row);
			
			setShoppingCartEventHandlers();
			saveCart();
		};


		var setShoppingCartEventHandlers = function() {
			
			//console.log('before');
			//console.log(checkout.dishes);

			// Event handler: Remove shopping cart item.
			$(".shopping-cart-item-remove").one("click", function(event) {
				console.log($(this).parent().attr('id'));

				var obj_id = $(this).parent().attr('id');
                // Prevent x from being clicked twice causing an error.
                $(this).on("click", function(event) {
                	event.preventDefault();
                });


                checkout.dishes.splice(obj_id, 1);

                console.log('after');
                console.log(checkout.dishes);
                updateshoppingcart();
                
                event.stopPropagation();
            });		
		}


			// $('#checkout-modal').on('hide.bs.modal', function(e){
			// 	$('#checkout-modal-form').trigger("reset");
			// });
		var ckeckout = function(){
			checkout.delivery_option = $('#delivery_option_selection option:selected').val();
			checkout.payment_option = $('#payment_option_selection option:selected').val();
			saveCart();
			console.log(checkout);

			$('#delivery_option').on('change', function(e){
				checkout.delivery_option = $('#delivery_option_selection option:selected').val();
				console.log(checkout);
				if($('#delivery_option_selection option:selected').val() == 'delivery'){

					var addressTemplate = 
					'<input id="address1" class="input-field" type="text" name="address1" required="required" autocomplete="on" maxlength="45" placeholder="Streed Address"/>' +

					'<input id="address2" class="input-field" type="text" name="address2"  autocomplete="on" maxlength="45" placeholder="Streed Address2"/>' +

					'<input id="city" class="column-left" type="text" name="city" required="required" autocomplete="on" maxlength="20" placeholder="City"/>' +

					'<input id="zipcode" class="column-right" type="text" name="zipcode" required="required" autocomplete="on" pattern="[0-9]*" maxlength="5" placeholder="ZIP code"/>' +
					'<input id="phone" type="tel" pattern="[0-9]{10}" name="Telephone" required="required" autocomplete="on" maxlength="10" placeholder="Phone Number"/>';

					$('#address').append(addressTemplate);

					$('#address').css("display","");
				}else{
					$('#address').empty();
					$('#address').css("display","none");
				}
			});

			$('#payment_option').on('change', function(e){
				e.preventDefault();
				checkout.payment_option = $('#payment_option_selection option:selected').val();
				console.log(checkout);
				if($('#payment_option_selection option:selected').val() == 'creditcard'){

					// var creditcardTemplate = '<div class="panel panel-default bootstrap-basic"> <form class="panel-body">' +
					// '<div class="row"> <div class="form-group col-xs-8"> <label class="control-label">Card Number</label>' +
					// '<div class="form-control" id="card-number"></div> <span class="helper-text"></span> </div>' +
					// '<div class="form-group col-xs-4"> <div class="row"> <label class="control-label col-xs-12">Expiration Date</label> ' +
					// '<div class="col-xs-6"> <div class="form-control" id="expiration-month"></div> </div>' +
					// '<div class="col-xs-6"> <div class="form-control" id="expiration-year"></div> </div> </div> </div> </div>' +
					// '<div class="row"> <div class="form-group col-xs-6"> <label class="control-label">Security Code</label>' +
					// '<div class="form-control" id="cvv"></div> </div>' +
					// '<div class="form-group col-xs-6"> <label class="control-label">Zipcode</label> ' +
					// '<div class="form-control" id="postal-code"></div> </div> </div>' +
					// '</form></div>';


					// var client_authorization ='';
					// $.get('http://127.0.0.1:8000/online-order/BTcreatClietToken').done(function(token){
					// 	client_authorization = token;
					// 	console.log(client_authorization);
					// 	braintreeClientSide(client_authorization);
					// });

					//$('#payment').append(creditcardTemplate);


					$('#payment').css("display","block");
				}else{
					//$('#payment').empty();
					$('#payment').css("display","none");
				}
			});

			$('#next').on('click', function(e){
				e.preventDefault();

				var current_page = $(this).attr("page-id"),
				next_page = parseInt(current_page) + 1;
				
				if(current_page ==1 && ($('#first-name').val()=="" || $('#last-name').val() == "" || $('#email').val() == "") ){

					if($('#first-name').val() == ""){

						$('#first-name').css("border","thick solid red");
					}else{
						$('#first-name').css("border","");
					}

					if($('#last-name').val() == ""){

						$('#last-name').css("border","thick solid red");
					}else{
						$('#last-name').css("border","");
					}

					if($('#email').val() == ""){

						$('#email').css("border","thick solid red");
					}else{
						$('#email').css("border","");
					}

					return
				}else{
					$('#1 input').each(function(){
						if($(this).value != ""){
							$(this).css("border","none");
						}
					})
				}

				if(current_page == 2 && ($('#delivery_option_selection option:selected').val() == 'delivery')){
							//$('#address2').val()=="" ||
							if($('#address1').val()=="" || $('#city').val()=="" || $('#zipcode').val()=="" || $('#phone').val() == ""){

								if($('#address1').val() == ""){

									$('#address1').css("border","thick solid red");
								}
								else{
									$('#address1').css("border","");
								}

								// if($('#address2').val() == ""){

								// 	$('#address2').css("border","thick solid red");
								// }
								// else{
								// 	$('#address2').css("border","");
								// }

								if($('#city').val() == ""){

									$('#city').css("border","thick solid red");
								}
								else{
									$('#city').css("border","");
								}

								if($('#zipcode').val() == ""){

									$('#zipcode').css("border","thick solid red");
								}
								else{
									$('#zipcode').css("border","");
								}

								if($('#phone').val() == ""){

									$('#phone').css("border","thick solid red");
								}else{
									$('#phone').css("border","");
								}

								return
							}else{
								$('#2 input').each(function(){
									if($(this).value != ""){
										$(this).css("border","none");
									}
								})
							}

							delivery_calculation($('#address1').val() + $('#city').val() + $('#zipcode').val());

							
						}

						console.log("10")

						$('#' + current_page).css("display","none");
						$('#' + next_page).css("display","");
						$('#pre').css("display","").attr("last-page-id", current_page);
						$(this).attr("page-id",next_page);

						if($(this).attr("page-id") == 3){
							$(this).css("display","none");
						}else{
							$(this).css("display","");
						}
					});

			$('#pre').on('click', function(e){
				var last_page_id = $('#pre').attr('last-page-id');
				var current_page_id = parseInt(last_page_id) + 1
				$('#'+ last_page_id).css("display","");
				$('#'+ current_page_id).css("display","none");
				$(this).attr("last-page-id",parseInt(last_page_id) - 1);
				$('#next').attr("page-id",last_page_id);
				if($('#next').css('display') == 'none'){
					$('#next').css('display',"");
				}
				if(last_page_id == 1){
					$('#pre').css("display","none").attr("last-page-id","1");
					$(this).attr("last-page-id","");
				}

			});
		}

		$('#checkout-modal').on('show.bs.modal', function(event){
			ckeckout();
			var client_authorization ='';
			$.get('http://127.0.0.1:8000/online-order/BTcreatClietToken').done(function(token){
				client_authorization = token;
				console.log(client_authorization);
				braintreeClientSide(client_authorization);
			});

		});

		//ckeckout();

		$("#signin-form").submit(function(e){
			e.preventDefault();
			input_fields = $(this).serializeArray();
			credentioal = {};
			$(input_fields).each(function(index, obj){
				credentioal[obj.name] = obj.value;
			} );
			//console.log(credentioal.email);
			$.ajax({
				url: 'http://127.0.0.1:8000/users/login/',
				type: 'POST',
				dataType: 'json',
				data: credentioal,
				beforeSend: function( xhr ) {
						//xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
						//confirm("yes?");
						xhr.setRequestHeader("Authorization", "Basic " + btoa(credentioal.email + ':' + credentioal.password));
					},
				}).success(function(data){
					//console.log(data);
					//result = jQuery.parseJSON(data)
					result = data
					$("#user-logedin").css("display","");
					$("#userLoginName").text(result.first_name);
					$("#login").css("display","none");
					$('#signin-signup').modal('toggle');

					$('#first-name').val(result.first_name);
					$('#last-name').val(result.last_name);
					$('#email').val(result.email);
					
					//checkout.user.push(result);

					for(var d in result){
						//console.log(d, "  :", result[d]);
						checkout.user[d] = result[d];
					}
					saveCart();
					
					//checkout.
					// $("#user-logedin").on('click', function(e){
					// 	$.post('http://127.0.0.1:8000/users/logout/');
					// });
				}).error(function(data) {
					console.log("error");
					console.log(data);
					text = data.responseText;
					text = text.substring(text.indexOf('[')+1,text.lastIndexOf(']'));

					alert(text);
				});
		});

		setTimeout(function(){
			//&& checkout.user.length != 0
			//console.log(jQuery.isEmptyObject(checkout.user)); 
			if(!jQuery.isEmptyObject(checkout.user) && checkout.user != undefined){
				$("#login").css("display","none");
				$("#user-logedin").css("display","");
				 $("#userLoginName").text(checkout.user.first_name);

				 $('#first-name').val(checkout.user.first_name);
				 $('#last-name').val(checkout.user.last_name);
				 $('#email').val(checkout.user.email);

			}
		}	, 500);


		$("#signup-form").submit(function(e){
			e.preventDefault();
			var signupFields = $(this).serializeArray();
			signupData = {}
			$(signupFields).each(function(index, obj){
				signupData[obj.name] = obj.value;
			});

			//console.log(signupData);

			if(signupData.email !== signupData.email2){
				alert("emails are not match");
				return;
			}

			if(signupData.password !== signupData.retryPassword){
				alert("the passwords are not match");
				return;
			}
			$.ajax({
				url: 'http://127.0.0.1:8000/users/register/',
				type: 'POST',
				dataType: 'json',
				data: signupData,
				}).success(function(data){
					//console.log(data);
					result = data
					$("#user-logedin").css("display","");
					$("#userLoginName").text(result.first_name);
					$("#login").css("display","none");
					$('#signin-signup').modal('toggle');

					$('#first-name').val(result.first_name);
					$('#last-name').val(result.last_name);
					$('#email').val(result.email);

					for(var d in result){
						//console.log(d, "  :", result[d]);
						checkout.user[d] = result[d];
					}
					saveCart();
					
				}).error(function(data) {
					console.log(data);
					text = data.responseText;
					text = text.substring(text.indexOf('[')+1,text.lastIndexOf(']'));

					alert(text);
				});


			})

		$('#logout').on('click', function(e){
			var conf = confirm("are you sure you want to log out? you will loose your order if you haven't submit!");
			if(conf){
				deletedata();
				location.reload();
			}
		});


		var delivery_calculation = function(destination){
			// $.get('https://maps.googleapis.com/maps/api/distancematrix/json?units=imperial&origins=90%20Peterborough%20St,%20Boston,MA&destinations='+ destination +'&key=AIzaSyAGbzWlcfZgzdkV502Oa7Iixj-s1HKzpq4')
			// .done(function(data){
			// 	console.log(data);
			// });


			var origin = '90 Peterborough St,Boston,MA';

			var service = new google.maps.DistanceMatrixService;
			service.getDistanceMatrix({
				origins: [origin],
				destinations: [destination],
				travelMode: 'DRIVING',
				//transitOptions: TransitOptions,
				//drivingOptions: DrivingOptions,
				unitSystem: google.maps.UnitSystem.IMPERIAL,
			}, function(response, status){

				if (status == 'OK') {
					var origins = response.originAddresses;
					var destinations = response.destinationAddresses;
					var distance,duration, deliveryRate= 3.0, totalDeliveryCharge=0.0;

					for (var i = 0; i < origins.length; i++) {
						var results = response.rows[i].elements;
						for (var j = 0; j < results.length; j++) {
							var element = results[j];
							// console.log("element");
							// console.log(element);
							distance = element.distance.text;
							duration = element.duration.text;
							var from = origins[i];
							var to = destinations[j];
						}
					}

					totalDeliveryCharge = deliveryRate * parseFloat(distance.split(' ')[0]);
					//alert("$"+totalDeliveryCharge + " has been added to your shoping cart");
					//if(confirm){
					checkout.delivery = totalDeliveryCharge;
					// console.log(totalDeliveryCharge);
					// console.log(checkout);
					//$('#delivery').val(totalDeliveryCharge.toFixed(2));
					updateshoppingcart();
					//}

				}
			});


			// $.ajax({
				
			// 	type: 'GET',
			// 	url:'https://maps.googleapis.com/maps/api/distancematrix/json',
			// 	//?units=imperial&origins=90%20Peterborough%20St,%20Boston,MA&destinations='+ destination +'&key=AIzaSyAGbzWlcfZgzdkV502Oa7Iixj-s1HKzpq4',

			// 	contentType: 'text/plain',
			// 	data: {units: 'imperial', origins: '90 Peterborough St,Boston,MA', destinations: destination, key:'AIzaSyAGbzWlcfZgzdkV502Oa7Iixj-s1HKzpq4'},
			// 	xhrFields: {
			// 		//The 'xhrFields' property sets additional fields on the XMLHttpRequest.
			// 		//This can be used to set the 'withCredentials' property.
			// 		//Set the value to 'true' if you'd like to pass cookies to the server.
			// 		//If this is enabled, your server must respond with the header
			// 		//'Access-Control-Allow-Credentials: true'.
			// 		withCredentials: true
			// 	},
			// 	// headers : {Accept : "application/json",
			// 	// "Access-Control-Allow-Origin" : "*",
			// 	// "Access-Control-Allow-Methods": "POST,GET,OPTIONS",
			// 	// "Access-Control-Allow-Headers": "X-Authorization,X-Requested-With, Content-Type, Origin, authorization, accept, client-security-token"},
			// 	//crossDomain: true,
			// 	datatype: 'json',
			// }).done(function(data){
			// 	console.log(data);
			// });

			// var xhr = new XMLHttpRequest();
			// xhr.open('GET', 'https://maps.googleapis.com/maps/api/distancematrix/json?units=imperial&origins=90%20Peterborough%20St,%20Boston,MA&destinations='+ destination +'&key=AIzaSyAGbzWlcfZgzdkV502Oa7Iixj-s1HKzpq4');

			// xhr.onload = function () {
			// 	console.log(xhr.responseText);
			// };
			// xhr.send();
		}

		//var form = document.querySelector('#cardForm');
		var braintreeClientSide= function(client_authorization){

			braintree.client.create({
				authorization: client_authorization
			}, function(clientErr, clientInstance){
				if(clientErr){
					console.log(clientErr);
					alert(clientErr);
					return;
				}
				console.log('clientInstance');
				console.log(clientInstance);
				createHostedFields(clientInstance);
			});

			function createHostedFields(clientInstance) {

				braintree.hostedFields.create({
					client: clientInstance,
					styles: {
						'input': {
							'font-size': '14px',
							'font-family': 'helvetica, tahoma, calibri, sans-serif',
							'color': '#3a3a3a'
						},
						':focus': {
							'color': 'black'
						}
					},
					fields: {
						number: {
							selector: '#card-number',
							placeholder: '4111 1111 1111 1111'
						},
						cvv: {
							selector: '#cvv',
							placeholder: '123'
						},
						expirationMonth: {
							selector: '#expiration-month',
							placeholder: 'MM'
						},
						expirationYear: {
							selector: '#expiration-year',
							placeholder: 'YY'
						},
						postalCode: {
							selector: '#postal-code',
							placeholder: '90210'
						}
					}
				}, function (hostedFieldsErr, hostedFieldsInstance) {
					if(hostedFieldsErr){
						console.log('hostedFieldsErr');
						console.log(hostedFieldsErr);
						return;
					}

					hostedFieldsInstance.on('validityChange', function (event) {
						console.log(event);
						var field = event.fields[event.emittedBy];

						if (field.isValid) {
							if (event.emittedBy === 'expirationMonth' || event.emittedBy === 'expirationYear') {
								if (!event.fields.expirationMonth.isValid || !event.fields.expirationYear.isValid) {
									return;
								}
							} else if (event.emittedBy === 'number') {
								$('#card-number').next('span').text('');
							}

							$(field.container).parents('.form-group').addClass('has-success');
						} else if (field.isPotentiallyValid) {

							$(field.container).parents('.form-group').removeClass('has-warning');
							$(field.container).parents('.form-group').removeClass('has-success');
							if (event.emittedBy === 'number') {
								$('#card-number').next('span').text('');
							}
						} else {

							$(field.container).parents('.form-group').addClass('has-warning');

							if (event.emittedBy === 'number') {
								$('#card-number').next('span').text('Looks like this card number has an error.');
							}
						}
					});

					hostedFieldsInstance.on('cardTypeChange', function (event) {

						if (event.cards.length === 1) {
							//$('#card-type').text(event.cards[0].niceType);
							$('#card-number').next('span').text(event.cards[0].niceType);
						} else {
							//$('#card-type').text('Card');
							$('#card-number').next('span').text('Card');
						}
					});

					$('#final-checkout').on('click',function (event) {
						event.preventDefault();
						if($('#payment_option_selection option:selected').val() == 'creditcard'){
							hostedFieldsInstance.tokenize(function (err, payload) {
								if (err) {
									console.log('payloadError');
									console.error(err);
									return;
								}
								console.log(payload);
								//alert('Submit your nonce to your server here!');

								customer_info = !jQuery.isEmptyObject(checkout.user) ? checkout.user : {'first_name' : $('#first-name').val(), 'last_name': $('#last-name').val(), 'email': $('#email').val()};

								data = {"nonce": payload.nonce, "amount": checkout.total, "customer": customer_info};
								console.log(data);

								$.ajax({
									url: 'http://127.0.0.1:8000/online-order/BTcreate_purchase',
									type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify(data),
									dataType: 'json',
								}).success(function(data){
									console.log("success transaction: ");
									console.log(data);
									console.log(data.status);

									if(data.status =='authorized' && data.settlement_result_status == 'submitted_for_settlement' && data.transaction_id != ''){
										console.log('lets go for next');

										$.ajax({
											url: 'http://127.0.0.1:8000/online-order/submitAPIView',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify(checkout),
											dataType: 'json',
										}).success(function(data){
											console.log(data);
										}).error(function(jqXHR, errorText, thrownError) {
											alert(thrownError);
										});


									}else{
										console.log("status: " + data.status + ",  settlement_result_status: " + data.settlement_result_status + ",  transaction_id: " + data.transaction_id);
										alert('your transaction has been rejected because: ' + data.status + " . Please reload/refresh the page then try it again.");
									}
								}).error(function(err){
									console.log('error');
									console.log(err);
								});

								//$('#checkout-modal').modal('toggle');

								// $('#checkout-modal').on('shown.bs.modal', function (event) {
								// 	$('#checkout-modal').focus();
								// });
								// console.log(checkout);
								// $.ajax({
								// 	url: 'http://127.0.0.1:8000/online-order/submitAPIView',
								// 	type: 'POST',
								// 	dataType: 'text',
								// 	data: checkout,
								// 	// beforeSend: function( xhr ) {
								// 	// 	//xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
								// 	// 	confirm("yes?");
								// 	// }
								// }).success(function(data){
								// 	console.log(data);
								// }).error(function(jqXHR, errorText, thrownError) {
								// 	alert(thrownError);
								// });
							});

						}else{

							alert("cash");
						}
						return false;

					});

				});

			}
		}




		// function getCookie(name) {
		// 	var cookieValue = null;
		// 	if (document.cookie && document.cookie !== '') {
		// 		var cookies = document.cookie.split(';');
		// 		for (var i = 0; i < cookies.length; i++) {
		// 			var cookie = jQuery.trim(cookies[i]);
		//             // Does this cookie string begin with the name we want?
		//             if (cookie.substring(0, name.length + 1) === (name + '=')) {
		//             	cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		//             	break;
		//             }
		//         }
		//     }
		//     return cookieValue;
		// }
		// var csrftoken = getCookie('csrftoken');

		// setTimeout(function(){
		// 	console.log(checkout);
		// }	, 500);







	});
</script>
</html>
