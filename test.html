<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script-->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <style type="text/css">
        /*
 * Base structure
 */

 /* Move down content because we have a fixed navbar that is 50px tall */
 body {
    padding-top: 50px;
}


/*
 * Global add-ons
 */

 .sub-header {
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

/*
 * Top navigation
 * Hide default border to remove 1px line.
 */
 .navbar-fixed-top {
    border: 0;
}

/*
 * Sidebar
 */

 /* Hide for mobile, show later */
/* .sidebar {
    display: none;
}*/
@media (min-width: 768px) {
    .sidebar {
        position: fixed;
        top: 51px;
        bottom: 0;
        left: 0;
        z-index: 1000;
        display: block;
        padding: 20px;
        overflow-x: hidden;
        overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
        background-color: #f5f5f5;
        border-right: 1px solid #eee;
    }
}

/* Sidebar navigation */
.nav-sidebar {
    margin-right: -21px; /* 20px padding + 1px border */
    margin-bottom: 20px;
    margin-left: -20px;
}
.nav-sidebar > li > a {
    padding-right: 20px;
    padding-left: 20px;
}
.nav-sidebar > .active > a,
.nav-sidebar > .active > a:hover,
.nav-sidebar > .active > a:focus {
    color: #fff;
    background-color: #428bca;
}

.checkout_sidebar{
    top: 10px;
    bottom: 0;
    left: 0;
    z-index: 1000;
    display: block;
    padding: 20px;
    overflow-x: hidden;
    overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */

    background-color: #f5f5f5;
    border-left: 1px solid #eee; 
}
/*
 * Main content
 */

 .main {
    padding: 20px;
}
@media (min-width: 768px) {
    .main {
        padding-right: 40px;
        padding-left: 40px;
    }
}
.main .page-header {
    margin-top: 0;
}


/*
 * Placeholder dashboard ideas
 */

 .placeholders {
    margin-bottom: 30px;
    text-align: center;
}
.placeholders h4 {
    margin-bottom: 0;
}
.placeholder {
    margin-bottom: 20px;
}
.placeholder img {
    display: inline-block;
    border-radius: 50%;
}
</style>

<!--script src="static/online_order/index.js"></script-->
</head>
<body>
    <!-- Menu items. -->
    <div id="menu-items-details" class="modal fade" tabindex="-1" role="dialog" data-displayed-menu-item-id="" > 

        <div id="menu-items-details-wrapper" class="modal-dialog">
            <form class="form-horizontal addTocart" method="" action="" autocomplete="off" name="addTocart" onsubmit="event.preventDefault();" >
                <div id="menu-items-details-content" class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="mTitle"></h4>                    
                    </div>

                    <div class="modal-body">



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add to Cart</button>
                    </div>

                </div>
            </form>   

        </div>

    </div> 
<!--div class="jumbotron">
        <div class="container">
            <h1>Hello, world!</h1>
            <p>This is a template for a simple marketing or informational website. It includes a large callout called a jumbotron and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
            <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more &raquo;</a></p>
            <ul class="nav nav-pills nav-stacked" id="mani"></ul>
        </div>
    </div-->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Project name</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Dashboard</a></li>
        <li><a href="#">Settings</a></li>
        <li><a href="#">Profile</a></li>
        <li><a href="#">Help</a></li>
    </ul>
    <form class="navbar-form navbar-right">
        <input type="text" class="form-control" placeholder="Search...">
    </form>
</div>
</div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar" id="mani">
                <!-- li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
                <li><a href="#">Reports</a></li>
                <li><a href="#">Analytics</a></li>
                <li><a href="#" id="t">Export</a></li-->
                </ul>

            </div>
            <div class="col-sm-6 col-sm-offset-3 col-md-7 col-md-offset-2 main">
                <h1 class="page-header">Dashboard</h1>
<!--
                < div class="row placeholders">
                    <div class="col-xs-6 col-sm-3 placeholder">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                        <h4>Label</h4>
                        <span class="text-muted">Something else</span>
                    </div>
                    <div class="col-xs-6 col-sm-3 placeholder">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                        <h4>Label</h4>
                        <span class="text-muted">Something else</span>
                    </div>
                    <div class="col-xs-6 col-sm-3 placeholder">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                        <h4>Label</h4>
                        <span class="text-muted">Something else</span>
                    </div>
                    <div class="col-xs-6 col-sm-3 placeholder">
                        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
                        <h4>Label</h4>
                        <span class="text-muted">Something else</span>
                    </div>
                </div>

                <h2 class="sub-header">Section title</h2>
-->
                <div class="table-responsive" id="section">
                    <table id="menutable">

                    </table>

                </div>

 
            </div>

            <div class="col-sm-3 col-md-3 checkout_sidebar">
            <p>check out</p>
            </div>

        </div>
    </div>

</body>
<script>


    $(document).ready(function (){

        var mainobj = {}
        $.get('http://127.0.0.1:8000/online-order/MenusAPIView/').done(function(data){
    //$.get('http://ec2-54-205-29-188.compute-1.amazonaws.com/online-order/MenusAPIView/').done(function(data){
        var d = data;
        //console.log(data)
        for(var i =0; i < d.length; i++){
            $('#mani').append('<li><a href="#" id="'+ d[i].id + '"' + 'value="' + d[i].menus_name  + '" >' + d[i].menus_name + '</a></li>');
        }

    });

    $.get('http://127.0.0.1:8000/online-order/FullListdisheshwithDetails/').done(function(data){

        mainobj = data;
        console.log(data);
    });

    

    setTimeout(function(){
        $('#mani a[id=' + Math.floor((Math.random() * 10) + 1) + ']').trigger("click");
// $("a").on("click", function(){
// var that = $(this);
// console.log(that.text());
// });


}, 500);

$("#mani").on("click", 'a', function(e){
    e.preventDefault();
    $("#section table").empty();


    var that = $(this);
    //console.log($(that).text());
    var menu_txt = $(that).text();

    var dish=[];
    // console.log('az inja: ');
    //     console.log(mainobj);
    $.each(mainobj, function(index, val){
        //console.log(val);
        if(val.menus_name === menu_txt){
            var objectOfthisMenu = this;
            // console.log("menu: ");
            // console.log(val.menus_name);
             //console.log(this);
             $.each(objectOfthisMenu.dishes, function(index, val){
                //console.log(val);    
                dish.push({dish_id: val.id, menu_id: val.menus, name: val.dishes_name, description: val.description});
            });

            // console.log("dish object: ");
            // console.log(dish);
        }

    });

    for (var i = 0; i < dish.length; i++) {
        //console.log( dish[i].name);

        $("#section table").append('<tr menu_id="' + dish[i].menu_id + '"  id="' + dish[i].dish_id + '" data-toggle="modal" data-target="#menu-items-details"><td><a href="#"><div class="dishName" value="' + dish[i].name + '"><h4>' + dish[i].name + '</h4></div>' + 
            '<div class="dishDescription">' + dish[i].description + '</div></a></td></tr>');
    }
});

// //add functinality that when you click on dishesh see the options
// // $('tr').on('click', 'a',function(event){

// // })
// //$('#menu-items-details').modal('show')


$('#menu-items-details').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget)
  var modal = $(this);
  console.log(button);
  // console.log(button.attr('menu_id'));
  // console.log(button.attr('id'));
  // console.log(button.find('.dishName h4').text());

  var menuId = button.attr('menu_id'), dishId = button.attr('id'), dishName = button.find('.dishName h4').text();
  console.log(menuId);
  console.log(dishId);
  console.log(dishName);

  $.each(mainobj, function(index, val){
    //console.log(val);
    if(val.id.toString() === menuId){
        console.log(val);
        $.each(val.dishes, function(i,v){



            if(v.id.toString() === dishId){
                console.log(v);

                var total = 0.00;
                total += parseFloat(v.sizes[0].price);//.toFixed(2);
                //console.log(typeof(total)); 
                var title = '<div><h4>' + v.dishes_name + '</h4>total: $' + total +'<div>';
                modal.find('.modal-title').html(title);
                var mdl = modal.find('.modal-body').empty();

                var res = '';
                
                console.log(v.sizes.length);
                if(v.sizes.length > 1 && v.sizes != undefined){
                    res += '<div class="form-group"><h4>Select size: </h4>';
                    $.each(v.sizes, function(i,val){
                        var price = (val.price)== null? null :  parseFloat(val.price).toFixed(2);
                        console.log(val);
                        res += '<div class="radio"><label>';
                        res += '<input type="radio" name="size" id="' + val.id + '" value="' + price +'">';
                        res += val.sizes + '($'+ price + ')';
                        res += '</label></div>'; 
                    });
                    
                }

                if(v.sides.length > 0 && v.sides != undefined){
                    res += '<div class="form-group"><h4>Select salad or side: </h4>';
                    res += '<select class="form-control" name="sides">';
                    $.each(v.sides, function(i,val){
                        //console.log(val);
                        
                        res += '<option  id="' +val.id +'" value="' +val.side_name +'" >';
                        res += val.side_name + '</option>';
                    });
                    res += '</select></div>'
                }

                if(v.riceOptions.length > 0 && v.riceOptions != undefined){
                    res += '<div class="form-group"><h4>Select rice dish: </h4>';
                    res += '<select class="form-control" name="riceOptions">';
                    $.each(v.riceOptions, function(i,val){
                        var price = (val.price)== null? null :  parseFloat(val.price).toFixed(2);
                        res += '<option  id="' +val.id +'" value="' +val.rice_name +'" data-extra-cost="'+ price +'">';
                        res += val.rice_name ;
                        if(val.price != null){
                            res += '(ADD $' + parseFloat(val.price).toFixed(2) +')' ;        
                        }
                        res += '</option>';
                    });
                    res += '</select></div>'
                }

                if(v.add.length > 0 && v.add != undefined){
                    res += '<h4>Add: </h4>';
                    $.each(v.add, function(i,val){
                        res += '<div class="checkbox">';
                        res += '<label><input type="checkbox" name="add" value="' + val.add_name +'" add_id="' + val.id +'" >';
                        var price = (val.price)== null? '' : '($' + parseFloat(val.price).toFixed(2) + ')';
                        res += val.add_name + price;
                        res += '</label></div>' 
                    });

                }

                res += '<div class="specialRequests"><textarea class="form-control" rows="2" placeholder="Special instructions, allergies, etc." name="specialRequests"></textarea>';                
                
                mdl.append(res);

                return false;
            }


        });

        return false;
    }

});

});

$('form.addTocart').submit(function(e){
    console.log($(this).serialize());
});



  //   if(dish_details.sizes != 0 || dish_details.sizes == undefined){
  //       $.each(dish_details.sizes, function(inx, val){

  //       });
  //   }

  //   //modal.find('.modal-body input').val(recipient)

  // });




});
</script>
</html>
